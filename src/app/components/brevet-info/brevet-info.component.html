<h2>Бревет
  <app-editable (update)="updateField('name')">
    <ng-template appViewMode>
      <span [attr.data-editable]="auth.isAdmin">{{brevet?.name}}</span>
    </ng-template>
    <ng-template appEditMode *ngIf="auth.isAdmin">
      <input matInput [formControl]="formGroup?.get('name')" value="{{brevet?.name}}" size="15">
    </ng-template>
  </app-editable>
</h2>
<p>Длина маршрута
  <app-editable (update)="updateField('length')">
    <ng-template appViewMode>
      <span [attr.data-editable]="auth.isAdmin">{{brevet?.length}}</span>
    </ng-template>
    <ng-template appEditMode *ngIf="auth.isAdmin">
      <input matInput [formControl]="formGroup?.get('length')" value="{{brevet?.length}}" size="5" type="number">
    </ng-template>
  </app-editable>
  км</p>
<div class="date-time-picker">Старт
  <app-editable (update)="updateField('startDate')">
    <ng-template appViewMode>
      <span [attr.data-editable]="auth.isAdmin">{{brevet?.startDate.toDate() | date: 'в HH:mm dd.MM.yyyy'}}</span>
    </ng-template>
    <ng-template appEditMode *ngIf="auth.isAdmin">
      <app-date-time-picker [formControl]="formGroup.get('startDate')" [value]="brevet?.startDate?.toDate()" name="startDate"></app-date-time-picker>
    </ng-template>
  </app-editable>
</div>

<p>Маршрут
  <app-editable (update)="updateMapUrl()">
    <ng-template appViewMode>
      <div *ngIf="brevet?.mapUrl" [attr.data-editable]="auth.isAdmin" class="url">{{brevet?.mapUrl}}</div>
      <span *ngIf="!brevet?.mapUrl" [attr.data-editable]="auth.isAdmin">отсутствует</span>
    </ng-template>
    <ng-template appEditMode *ngIf="auth.isAdmin">
      <input matInput [formControl]="formGroup?.get('mapUrl')" value="{{brevet?.mapUrl}}" size="15">
    </ng-template>
  </app-editable>
  <a *ngIf="brevet?.mapUrl" [href]="brevet?.mapUrl" target="_blank" title="открыть"><mat-icon>launch</mat-icon></a>
</p>

<div *ngIf="brevet?.mapUrl" class="plotaroutMap">
  <button mat-raised-button *ngIf="!showMap" (click)="showMap=!showMap"><mat-icon>map</mat-icon>Карта</button>
  <button mat-raised-button *ngIf="showMap"  (click)="showMap=!showMap"><mat-icon>expand_less</mat-icon>Карта</button>
  <app-plotaroute-map *ngIf="mapId && showMap" [mapId]="mapId"></app-plotaroute-map>
</div>

<h3>Контрольные пункты</h3>
<app-add-button *ngIf="auth.isAdmin" (click)="addCheckpoint()"></app-add-button>
<mat-list>
  <mat-list-item *ngFor="let checkpoint of (checkpoints$ | async)">
    <button mat-icon-button *ngIf="auth.isAdmin" (click)="deleteCheckpoint(checkpoint?.uid)">
      <mat-icon>delete_forever</mat-icon>
    </button>
    <a [title]="checkpoint.displayName" [routerLink]="['/brevet', brevet?.uid || 'none', 'checkpoint', checkpoint?.uid || 'none']">{{checkpoint?.displayName}}</a>,
    {{checkpoint.distance}} км
  </mat-list-item>
</mat-list>

<h3 *ngIf="allowCheckIn">Самоотметка</h3>
<p *ngIf="allowCheckIn">
  <button mat-raised-button (click)="startScanner()">
    <mat-icon>camera_alt</mat-icon>
    Сканировать
  </button>
  <button *ngIf="geoLocation.isLocationAvailable()" mat-raised-button (click)="locate()">
    <mat-icon>my_location</mat-icon>
    Координаты
  </button>
</p>

<h3>Отметки участников</h3>
<table mat-table [dataSource]="progress">
  <ng-container [matColumnDef]="column" *ngFor="let column of columnsToDisplay">
    <th mat-header-cell *matHeaderCellDef> {{columnNames[column]}} </th>
    <td mat-cell *matCellDef="let rider"> {{column === "name" ? rider.name : rider[column]?.toDate() | date:'HH:mm'}} </td>
  </ng-container>
  <tr mat-header-row *matHeaderRowDef="columnsToDisplay; sticky: true"></tr>
  <tr mat-row *matRowDef="let rider; columns: columnsToDisplay"></tr>
</table>

<app-login-prompt></app-login-prompt>
